We get the Changed= true when we execute the command 1st time and then 2nd time when 2nd time it will be
success because that is the state of system which is desired state.

Ansible alwsay check Actual state with desired state, if there is no chnaged then it is success state,
If there is chnage then the state will be Chnaged state.

Module Ping to check the connectiom
# ansible -m ping localhost

Module file to create the file and directory, Replace touch with directory to create the directory.
# ansible -m file -a "dest=test state=touch" localhost

Module to remove the file and directory,
# ansible -m file -a "dest=test state=absent" localhost

CHeck the document for Module 
# ansible-doc <ModuelName>

Module Copy to add content on the file, to move the file 
# ansible -m copy -a "dest=test content=world" localhost
# ansible -m copy -a "src=test dest=bro" localhost

Check Mode will take us though every part of the process, excepts actully replacing the file.
CHeck if there is any chnage without changing any configuration.   
# ansible -m copy -a "src=test dest=bro" localhost --check 

Diff mode to check what  will be changed after the configuration,
# ansible -m copy -a "src=test dest=bro" localhost --check --diff

Module timezone to chnabge the time zone.
# ansible -m timezone -a "name=AMerica/New_York" localhost

Inventory - Set of node where all command got executed.
Need to add the IP and hostname in /etc/hosts file to get it work. 
# ansible -i 'p1,' -m ping p1
# ansible -i 'p1,p2,' -m ping all

Module Command that will execute on set of nodes,
# ansible -i 'p1,p2' -m command -a 'date' all
# ansible -i 'p1,p2,p3' -m command -a 'date' '!p3' that will exclude the p3 as this is not present in
host and will give error if not mentioned !p3 in command.

Inventory - We can create the inventory file to setup the nodes,
Create file with any name my_inventory add nodes hostname, p[1:2]
# ansible -i my_inventory -m ping all
# ansible -i my_inventory -m command -a 'date' all

Inventory - We can use /etc/ansible/ansible.cfg this file to use defaults inventory,
[defaults]
inventory=/home/ubuntu/my_inventory
And under Inventory file my_inventory use 
p[1:2]
SO we can drop the invetory file form the command it take it from the configuration.
# ansible -m command -a 'date' all

ansible-config will be doing the below work,
    list                Print all config options
    dump                Dump configuration
    view                View configuration file
    init                Create initial configuration
    validate            Validate the configuration file and environment variables. By default it only checks the base settings without accounting for plugins (see -t).

# ansible-config dump --only-changed - will check what has been chnaged in ansible.cfg file.
# ansible-config dump - will show all configuration for config file. -- Green- no changes, yellow- something is changed.
# ansible-config list -- Shows the document configurations.

ansible-inventory -- will help you get the all you invetory in format
# ansible-inventory --list  --yaml -- it will show inventory in yaml format. 

--become flag is used to give privileges to the ansible to run command on remote that require the root 
privileges.

# ansible -m timezome -a 'name=America/Chicago' all --become 

--ask-become-pass -- will ask the prompt password in the console 
# ansible -m timezome -a 'name=America/Chicago' localhost --become --ask-become-pass 

--------------------------------------------------------------------------------------------------

-tags in the command help to run that following task in the playbook.
# ansible-playbook playbook.yml --check --tags webdeploy,
Example: This is used to tag one module only with copy
- hosts: all
  become: yes
  tasks:
    - name: Copy file
      copy:
        src: test
        dest: test
      tags:
        - webdeploy

Other Example: This is used to tag one module only with copy
- name: add content on file
  hosts: all
  tasks:
    - copy:
        src: test
        dest: people
      tags: apache
    - file:
        dest: testnew
        state: touch

Other Example: This is used to tag whole task with module copy and file 
- name: add content on file
  hosts: all
  tags: apache
  tasks:
    - copy:
        src: test
        dest: people     
    - file:
        dest: testnew
        state: touch

---------------------------------------------------------------------

diff: true   --- check what will be the diffrenece in the file or the configuration but will change it.
check_mode: true -- check what going to be changed in remote without changing it.
# ansible-playbook playbook.yml --check  --diff

Example:
- hosts: all
  become: yes
  tasks:
    - name: Copy file
      diff: true
      check_mode: true
      copy:
        src: test
        dest: bro
      tags:
        - webdeploy

You can use check_mode and diff for single module or the whole task as you can refer -tags fro examples

--------------------------------------------------------------------------
Under module apt
we have attribute to update the server packages before installing any package.
- hosts: all
  become: yes
  tasks:
    - name: updating os
     apt:
       name: apache2
       update_cache: true
    - name: install apache
      apt:
        name: apache2
        state: latest
    - name: enable https
      service:
        name: apache2
        state: started
        enabled: yes

 --------------------------------------------------------------------------

 # ansible -m setup all -a "filter=ansible_distribution*"
 The command show the OS ditribution for all the invetory.
 We see the gathering fact in ansible-play output behind the scene we are running this setup module 
 So you have that information availble to feed into your configuration.

 --------------------------------------------------------------------------

Debug Module to display the facts.
  tasks:
    - name: dump some facts
     debug:
        var: ansible_distribution
 --------------------------------------------------------------------------

Conditional tasks with the -when keyword
So here you can put the condition on basis of any thing like distribution or other, to run the command
On below exmaple we are putting condition that if the distribution is ubuntu only that module will
run else it will skip other and vice versa for Rehdat.
Example:
- name: Installing apache on ubuntu
  hosts: all
  tags: apache
  tasks:
    - name: dump some facts
      debug:
        var: ansible_distribution
      when: ansible_distribution == "Ubuntu"
    - name: install apache
      apt:
        name: apache2
        state: latest
      when: ansible_distribution == "Ubuntu"
    - name: enable https
      service:
        name: apache2
        state: started
        enabled: yes
      when: ansible_distribution == "Ubuntu"
    - name: Add content in the file
      diff: true
      copy:
        dest: /var/www/html/index.html
        content: helloworldnewdone
- name: Installing httpd on redhat 
  hosts: all
  become: true
  tasks:
    - name: dump some facts
      debug:
        var: ansible_distribution
      when: ansible_distribution == "RedHat"
    - name: install httpd
      dnf:
        name: httpd
        state: latest
      when: ansible_distribution == "RedHat"
    - name: enable httpd
      service:
        name: httpd
        state: started
        enabled: yes
      when: ansible_distribution == "RedHat"

--------------------------------------------------------------------------
To disable the gathering fact in ansible playbook output
gather_facts: false 
use above attibute in the playbook 
--------------------------------------------------------------------------

gather_subset: 
Gathers facts about remote hosts 
https://docs.ansible.com/ansible/latest/collections/ansible/builtin/setup_module.html
Example:
- hosts: all
  gather_subset:
    - "!min"
    - processor
  tasks:
    - debug:
        var: ansible_facts

--------------------------------------------------------------------------

# ansible-doc -t keyword <gather_facts, become, hosts, etc>
Above command help to get all details about the attibute.
# ansible-doc --list -- show all module list
--------------------------------------------------------------------------

# ansible-galaxy collection list
The command show the collection list. 
# ansible-galaxy collection install <namespace>.<collection_name>
# ansible-galaxy collection install community.general

2. Installing from a Local Tarball (Offline):
If you have downloaded a collection as a .tar.gz archive, you can install it locally.
Code

# ansible-galaxy collection install /path/to/your/collection-archive.tar.gz
4. Installing Multiple Collections with a Requirements File:
For managing multiple collections, a requirements.yml file can be used:
Code

# requirements.yml
collections:
  - community.general
  - ansible.posix
  - my_namespace.my_collection:==1.0.0
Then, install them using:
Code

# ansible-galaxy collection install -r requirements.yml
5. Specifying Installation Path:
By default, collections are installed in ~/.ansible/collections. You can specify an alternative installation path using the -p or --collections-path option:
Code

# ansible-galaxy collection install community.general -p /path/to/my_project/collections

--------------------------------------------------------------------------
Running docker container from ansible play, Managed node need to insatlled with docker then only work 
with ansible playbook. 

Example:
- name: Create container to use as ansible managed nodes
  hosts: all
  tasks:
  - name: dump some facts
    debug:
      var: ansible_distribution
    when: ansible_distribution == "Ubuntu"
  - community.docker.docker_container:
      name: c1
      image: python
      tty: true
      interactive: true
    when: ansible_distribution == "Ubuntu"

--------------------------------------------------------------------------
loop keyword: This is the list, used to get the valuse in loop for the creating seperate conatiners.

Example:
- name: Create container to use as ansible managed nodes
  hosts: all
  tasks:
  - name: dump some facts
    debug:
      var: ansible_distribution
    when: ansible_distribution == "Ubuntu"
  - community.docker.docker_container:
      name: "{{ item }}"  # This is known as Jinja template and inside its jija expression, 
# it will evalute to the values of the loop variable. 
      image: python  
      tty: true
      interactive: true
    when: ansible_distribution == "Ubuntu"
    loop:
      - c1
      - c2
--------------------------------------------------------------------------

range() function: is used looping over the conatiner module to create mutiple conatiners. instead hardcoding
the vaules in loop

Example:
- name: Create container to use as ansible managed nodes
  hosts: all
  tasks:
  - name: dump some facts
    debug:
      var: ansible_distribution
    when: ansible_distribution == "Ubuntu"
  - community.docker.docker_container:
      name: "c{{ item }}"  # This is known as Jinja template and inside its jija expression, 
# it will evalute to the values of the loop list variable. 
      image: python  
      tty: true
      interactive: true
    when: ansible_distribution == "Ubuntu"
    loop: "{{ range(1,4) }}"
    
--------------------------------------------------------------------------
Static Inventory for a container with ansible-connection:
Create static.ini file and add below line c1 is the docker container name and other are collection 
for docker connection.
# c1 ansible_connection=community.docker.docker

--------------------------------------------------------------------------
Dynamic Inventory plugin for a docker container:

Create a file with name <any-name>-docker.yaml (at the end of file "docker" name should be there its mandatory)
Add below file to access the docker api, uncomment when you update the file.
#plugin: community.docker.docker_containers
#docker_host: tcp://172.31.92.193:2375

To access the docker container you need to Configure remote access for Docker daemon in you managed nodes.
# https://docs.docker.com/engine/daemon/remote-access/#configuring-remote-access-with-daemonjson
tcp://127.0.0.1:2375 This need to be replace with you private IP.
Once done you need to open the port 2375 fro non secure or If you are using TLS port 2376.
Then try to ping the conatiners with below command,
# ansible -m ping -i dynamic-docker.yaml all

Once done update the ansible.cfg file with the dynamic-docker.yaml file so you won't be explictly 
add the file in command.
--------------------------------------------------------------------------
interpreter discovery warning:
Suppressing the python interpreter discovery warning
below cammand will help you to get the configuration for adding the python, you just have to 
search for fallback.
# ansible-config list 
add below line in ansible.cfg to Suppressed the python interpreter discovery warning
# interpreter_python= auto_silent
--------------------------------------------------------------------------

Below command help to control the task parallelism, like the task will be execute with 2 count as mentioned.
# ansible-playbook rolling.yml --forks 2 
--------------------------------------------------------------------------
Serial Keyword:
Using the serial keyword the all the task will be executed in count mananer,(To batch nodes)
If we have 3 task and we mentioned the serial in playbook as 3, then playbook will be executed 3 times,
as per nodes.
1 task, 2nd task and 3rd task -- repeat -- repeat (copy files, configure web server -- repeat -- repeat)
Example:
- name: Create container to use as ansible managed nodes
  hosts: all
  serial: 3
  tasks:
  - name: copy files
    command: sleep 1
  - name: configure web server
    command: sleep 1
--------------------------------------------------------------------------

Dynamic files with template module :

Jinja technique to get the varible dynamically, if you want example please use the files template.yml
and server.conf.j2 file will help to uderstand in detail way.

# ansible -m command -a 'ls /etc/server.conf' -i dynamic-docker.yaml  all   - will check if that exist
# ansible-playbook template.yml -i dynamic-docker.yaml -- will execute on the docker nodes
# ansible -m command -a 'ls /etc/server.conf' -i dynamic-docker.yaml  all  -- last will check if that updated.

--------------------------------------------------------------------------

Cleanup container with state:absent and force_kill:true :

Example:
- name: Create container to use as ansible managed nodes
  hosts: all
  tasks:
  - name: dump some facts
    debug:
      var: ansible_distribution
    when: ansible_distribution == "Ubuntu"
  - community.docker.docker_container:
      name: "c{{ item }}"  # This is known as Jinja template and inside its jija expression, 
# it will evalute to the values of the loop list variable. 
      image: python  
      tty: true
      interactive: true
      state: absent  # garcefull stopping of container 
      force_kill: true  # bypass garcefull stopping of container
    when: ansible_distribution == "Ubuntu"
    loop: "{{ range(1,4) }}"
    
--------------------------------------------------------------------------

module_defaults: Reduce the repetative module Args 

Example:
- name: Create container to use as ansible managed nodes
  hosts: all
  module_defaults:
    community.docker.docker_container:
      force_kill: true
      state: absent
  tasks:
  - name: dump some facts
    debug:
      var: ansible_distribution
    when: ansible_distribution == "Ubuntu"
  - community.docker.docker_container:
      name: "c{{ item }}"  # This is known as Jinja template and inside its jija expression, 
# it will evalute to the values of the loop list variable. 
      image: python  
      tty: true
      interactive: true
    when: ansible_distribution == "Ubuntu"
    loop: "{{ range(1,4) }}"
  - community.docker.docker_container:
      name: sleeper
      image: python
      command: sleep infinity  
      tty: true
      interactive: true
    when: ansible_distribution == "Ubuntu"
    loop: "{{ range(1,4) }}"

--------------------------------------------------------------------------

Host Delegation: 

- hosts: all
  become: yes
  tasks:
    - name: install apache
      apt:
        name: apache2
        state: latest
    - name: enable https
      service:
        name: apache2
        state: started
        enabled: yes
    - name: Adding index file
      file:
        path: /var/www/html/index.html
        state: touch
    - name: Add content to index.file
      copy:
        content: "Akshay Virkhare"
        dest: /var/www/html/index.html
      register: output
    - name: Check the status of the remote server
      uri:
        url: http://{{ inventory_hostname }}
        method: GET
        timeout: 30
        status_code: 200
        return_content: yes
      delegate_to: p1
      register: webresult
    - debug: msg="Register ouput is {{webresult}}"


--------------------------------------------------------------------------
#ansible-playbook mutliple.yaml --tags user -- with this only user tag will run
#ansible-playbook mutliple.yaml --skip-tags user  -- with this it will run all except user tag.

Example:
- name: Mutiple Play
  hosts: p1
  tasks:
    - name: Install httpd on p1
      dnf:
        name: httpd
        state: present
    - name: create user on p1
      user:
        name: akshaynew
        state: present
      tags: user
- name: Second Play
  hosts: p2
  tasks:
    - name: Install httpd on p2
      dnf:
        name: httpd
        state: present
    - name: Craete user on p1
      user:
        name: shrutinew
        state: present
      tags: user
--------------------------------------------------------------------------
Create user with loop with list, variable list in vars and condition to create user with guest.
loop let you repeat the same task for mutiple times, each time using different or set of values
When decide which task ot play to run

Example:
- name: Using Conditional
  hosts: p1
  vars:
    create_user: true
    user_name: andrei
    users:
      - ana
      - jim
      - guest
    user_count: 2
  tasks:
    - name: Create a user using condition
      user:
        name: "{{ user_name }}"
        state: present
    - name: Create user from the list
      user:
        name: "{{ item }}"
        state: present
      loop:
        - user1
        - user2
        - user3
    - name: Create user from a list variable skipping the user guest
      user:
        name: "{{item}}"
        state: present
      loop: "{{ users }}"
      when: item != 'guest'
    - name: Interger Comparison
      debug:
        msg: "We are creating the more than one user"
      when: user_count > 1

--------------------------------------------------------------------------

varible:

1) Group variable defind in the inventory has low proirity 
2) Then Group varible defined in the files in a group_vars sub-directory
3) followed by Host varible defind in the inventory 
4) Host variable defined in files in host_vars sub-directory take over group_vars
5) Host facts discoverd at runtime.


Example:
I have attached this example in the code. please check the user creation with all varible example folder. 
---
- name: show variables 
  hosts: webservers
  vars_files:
    - vars/comman_users.yaml
  vars:
    play_var: This was defind in the playbook
  tasks:
    - name: SHow group_vars user
      debug:
        var: default_user
    - name: show host_vars user
      debug:
        var: host_users
    - name: SHow Conditional user list
      debug:
        var: user_list
    - name: Show play-level variable
      debug:
        var: play_var

- name: Managing Users with variables
  hosts: webservers
  vars_files: vars/comman_users.yaml
  tasks:
    - name: Create group users
      user:
        name: "{{item.name}}"
        uid: "{{item.uid}}"
        state: present
      loop: "{{default_user}}"
      when: create_default_users
    - name: CReate hosts Users
      user:
        name: "{{item.name}}"
        uid: "{{item.uid}}"
        state: present
      loop: "{{host_users}}"
    - name: Conditional create user from list
      user:
        name: "{{item.name}}"
        state: present
        uid: "{{item.uid}}"
        groups: "{{item.group}}"
      loop: "{{user_list}}"
      when: item.create

--------------------------------------------------------------------------

